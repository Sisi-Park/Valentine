<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link href="https://fonts.googleapis.com/css2?family=Courier+Prime&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">

<title>Will you be my Valentine?</title>

<style>
body{
  margin:0;
  min-height:100vh;
  display:grid;
  place-items:center;
  background:linear-gradient(135deg,#ffafbd,#ffc3a0);
  font-family:'Quicksand',sans-serif;
}

.card{
  width:min(600px,92vw);
  background:rgba(255,255,255,0.97);
  border-radius:30px;
  padding:40px 28px 32px;
  box-shadow:0 30px 80px rgba(0,0,0,0.2);
  text-align:center;
  position:relative;
  overflow:hidden;
}

h1{
  margin:0 0 25px;
  font-size:34px;
  font-weight:600;
  color:#ff3e6c;
  letter-spacing:0.5px;
}

/* Envelope */
.letter-wrap{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:20px;
  margin-bottom:25px;
}

.envelope{
  width:260px;
  height:190px;
  border:none;
  background:transparent;
  cursor:pointer;
  position:relative;
  padding:0;
}

.env-body{
  position:absolute;
  inset:0;
  background:white;
  border-radius:40px;
  box-shadow:0 20px 60px rgba(0,0,0,0.2);
}

.env-flap{
  position:absolute;
  left:0;
  right:0;
  top:0;
  height:65%;
  background:rgba(255,80,120,0.25);
  border-radius:40px 40px 55px 55px;
  transform-origin:top center;
  transform:rotateX(0deg);
  transition:transform 650ms ease;
}

.env-seal{
  position:absolute;
  left:50%;
  top:55%;
  transform:translate(-50%,-50%);
  font-size:34px;
}

.envelope.open .env-flap{
  transform:rotateX(170deg);
}

/* LETTER STYLE (TYPEWRITER) */
.letter{
  width:min(500px,92vw);
  background:#fff;
  border-radius:28px;
  padding:28px;
  box-shadow:0 15px 40px rgba(0,0,0,0.18);
  opacity:0;
  max-height:0;
  overflow:hidden;
  transition:opacity 400ms ease, max-height 600ms ease;

  font-family:'Courier Prime', monospace;
  font-size:20px;
  line-height:1.8;
  color:#222;
  text-align:left;
  letter-spacing:0.5px;
}

.letter.show{
  opacity:1;
  max-height:520px;
}

/* Typed text + cursor */
#typed{
  white-space: pre-wrap; /* respects newlines */
  word-break: break-word;
}
.cursor{
  display:inline-block;
  width:10px;
  margin-left:2px;
  animation: blink 1s steps(1) infinite;
}
@keyframes blink { 50% { opacity: 0; } }

/* Heart burst */
.pop-heart{
  position:absolute;
  left:50%;
  top:40px;
  transform:translateX(-50%);
  animation:pop 1s ease forwards;
  pointer-events:none;
}

@keyframes pop{
  0%{opacity:0;transform:translate(-50%,0) scale(.5);}
  20%{opacity:1;}
  100%{opacity:0;transform:translate(calc(-50% + var(--dx)),var(--dy)) scale(1.4);}
}

/* Buttons */
.btns{
  display:flex;
  justify-content:center;
  gap:18px;
  margin-top:25px;
}

button.action{
  border:none;
  border-radius:999px;
  padding:14px 26px;
  font-size:18px;
  cursor:pointer;
  font-family:'Quicksand',sans-serif;
  transition:transform .25s ease;
}

#yes{
  background:#ff4d79;
  color:white;
}

#no{
  background:#f2f2f2;
  color:#333;
  position:relative;
}
</style>
</head>

<body>

<div class="card">
  <h1 id="headline">Will you be my Valentine?</h1>

  <div class="letter-wrap">
    <button class="envelope" id="openLetter" type="button" aria-label="Open letter">
      <div class="env-body"></div>
      <div class="env-flap"></div>
      <div class="env-seal">üíå</div>
    </button>

    <div class="letter" id="letter">
      <div id="typed"></div><span class="cursor" id="cursor">|</span>
    </div>
  </div>

  <div class="btns">
    <button class="action" id="yes">Yes üíò</button>
    <button class="action" id="no">No</button>
  </div>
</div>

<script>
const params = new URLSearchParams(location.search);
const name = params.get("name");
if (name) {
  document.getElementById("headline").textContent = name + ", will you be my Valentine?";
}

const openBtn = document.getElementById("openLetter");
const letterEl = document.getElementById("letter");
const typedEl = document.getElementById("typed");
const cursorEl = document.getElementById("cursor");

const FULL_TEXT =
`Nick,

Thank you for showing me a kind of love I didn't know was possible.

Will you be my Valentine?`;

let opened = false;
let typing = false;

function burstHearts() {
  const hearts = ["üíñ","üíò","üíï","‚ù§Ô∏è"];
  for (let i = 0; i < 18; i++) {
    const h = document.createElement("div");
    h.className = "pop-heart";
    h.textContent = hearts[Math.floor(Math.random() * hearts.length)];
    h.style.setProperty("--dx", (Math.random() * 240 - 120) + "px");
    h.style.setProperty("--dy", (-(Math.random() * 200 + 80)) + "px");
    openBtn.appendChild(h);
    setTimeout(() => h.remove(), 1000);
  }
}

function typeText(text, speedMs = 28) {
  if (typing) return;
  typing = true;
  typedEl.textContent = "";
  cursorEl.style.display = "inline-block";

  let i = 0;
  const tick = () => {
    // Append one character at a time
    typedEl.textContent += text[i];
    i++;

    if (i < text.length) {
      setTimeout(tick, speedMs);
    } else {
      // Done typing
      typing = false;
      // Keep cursor for 1s then hide (optional)
      setTimeout(() => { cursorEl.style.display = "none"; }, 900);
    }
  };
  // If empty, just stop
  if (!text || text.length === 0) {
    typing = false;
    cursorEl.style.display = "none";
    return;
  }
  setTimeout(tick, speedMs);
}

openBtn.addEventListener("click", () => {
  if (opened) return;
  opened = true;

  openBtn.classList.add("open");
  letterEl.classList.add("show");
  burstHearts();

  // Start typing shortly after opening
  setTimeout(() => typeText(FULL_TEXT, 28), 220);
});

const noBtn = document.getElementById("no");
const yesBtn = document.getElementById("yes");
let count = 0;

function moveNo() {
  count++;
  yesBtn.style.transform = `scale(${1 + count * 0.15})`;
  noBtn.style.transform = `scale(${Math.max(0.3, 1 - count * 0.12)})`;

  const x = Math.random() * 200 - 100;
  const y = Math.random() * 120 - 60;
  noBtn.style.position = "relative";
  noBtn.style.left = x + "px";
  noBtn.style.top = y + "px";
}

noBtn.addEventListener("mouseenter", moveNo);
noBtn.addEventListener("touchstart", moveNo, { passive: true });

yesBtn.addEventListener("click", () => {
  const q = name ? `?name=${encodeURIComponent(name)}` : "";
  window.location.href = `yes.html${q}`;
});
</script>

</body>
</html>
